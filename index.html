<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/png" href="/logo.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no, user-scalable=no" />
    
    <!-- Fallback refresh for stuck pages -->
    <script>
      setTimeout(function() {
        if (document.getElementById('initial-loading')) {
          console.warn('Page loading timeout, showing fallback');
          document.body.innerHTML = '<div style="padding: 20px; text-align: center; font-family: Arial, sans-serif;"><h2>Mobileuurka</h2><p>Loading the application...</p><button onclick="location.reload()" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">Refresh</button></div>';
        }
      }, 15000);
    </script>
    
    <!-- Critical Polyfills - Load First -->
    <script>
      // Promise.withResolvers polyfill - CRITICAL for compatibility
      if (!Promise.withResolvers) {
        Promise.withResolvers = function () {
          let resolve, reject;
          const promise = new Promise((res, rej) => {
            resolve = res;
            reject = rej;
          });
          return { promise, resolve, reject };
        };
      }
      
      // Array.prototype.at polyfill
      if (!Array.prototype.at) {
        Array.prototype.at = function (index) {
          const len = this.length;
          const relativeIndex = index < 0 ? len + index : index;
          if (relativeIndex < 0 || relativeIndex >= len) {
            return undefined;
          }
          return this[relativeIndex];
        };
      }
      
      // String.prototype.replaceAll polyfill
      if (!String.prototype.replaceAll) {
        String.prototype.replaceAll = function (searchValue, replaceValue) {
          if (typeof searchValue === "string") {
            return this.split(searchValue).join(replaceValue);
          }
          return this.replace(searchValue, replaceValue);
        };
      }
      
      // Object.hasOwn polyfill
      if (!Object.hasOwn) {
        Object.hasOwn = function (obj, prop) {
          return Object.prototype.hasOwnProperty.call(obj, prop);
        };
      }
      
      console.log("âœ… Critical polyfills loaded in HTML head");
    </script>
    
    <!-- Enhanced Android crash prevention -->
    <script>
      // Comprehensive Android crash prevention
      var ua = navigator.userAgent;
      var isAndroid = /Android/i.test(ua);
      var isOldAndroid = false;
      
      if (isAndroid) {
        var match = ua.match(/Android (\d+)/);
        var version = match ? parseInt(match[1]) : 0;
        isOldAndroid = version <= 10;
        
        console.log('Android detected (version: ' + version + '), applying crash fixes');
        
        // 1. Block font loading immediately
        if (window.FontFace) {
          window.FontFace = function() { return { load: function() { return Promise.resolve(); } }; };
        }
        
        // 2. Apply safe fonts
        var style = document.createElement('style');
        style.textContent = '* { font-family: system-ui, -apple-system, Roboto, Arial, sans-serif !important; }';
        document.head.appendChild(style);
        
        // 3. Enhanced error handling
        window.addEventListener('error', function(e) {
          var message = e.message || '';
          var filename = e.filename || '';
          
          // Block font errors
          if (message.includes('font') || message.includes('CFF') || message.includes('OTS')) {
            console.log('Font error blocked');
            e.stopPropagation();
            e.preventDefault();
            return false;
          }
          
          // Block reCAPTCHA errors
          if (message.includes('Timeout') && filename.includes('recaptcha')) {
            console.log('reCAPTCHA timeout error blocked');
            e.stopPropagation();
            e.preventDefault();
            return false;
          }
          
          // Block other reCAPTCHA errors
          if (filename.includes('recaptcha') || message.includes('recaptcha')) {
            console.log('reCAPTCHA error blocked');
            e.stopPropagation();
            e.preventDefault();
            return false;
          }
        }, true);
        
        // 4. Handle unhandled promise rejections
        window.addEventListener('unhandledrejection', function(e) {
          var reason = e.reason || {};
          var message = reason.message || reason.toString() || '';
          
          if (message.includes('recaptcha') || message.includes('Timeout')) {
            console.log('reCAPTCHA promise rejection blocked');
            e.preventDefault();
            return false;
          }
        });
        
        // 5. Override setTimeout for old Android devices
        if (isOldAndroid) {
          var originalSetTimeout = window.setTimeout;
          window.setTimeout = function(callback, delay) {
            // Minimum 100ms delay for old Android
            delay = Math.max(delay || 0, 100);
            return originalSetTimeout.call(this, callback, delay);
          };
        }
        
        // 6. Disable complex animations on old devices
        if (isOldAndroid) {
          var animStyle = document.createElement('style');
          animStyle.textContent = `
            *, *::before, *::after {
              animation-duration: 0.01ms !important;
              animation-iteration-count: 1 !important;
              transition-duration: 0.01ms !important;
            }
          `;
          document.head.appendChild(animStyle);
        }
      }
    </script>
    
    <!-- Mobile Web App Meta Tags -->
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="Mobileuurka" />
    <meta name="application-name" content="Mobileuurka" />
    <meta name="msapplication-TileColor" content="#ffffff" />
    <meta name="theme-color" content="#ffffff" />
    
    <!-- Mobile SEO Optimization -->
    <meta name="format-detection" content="telephone=no" />
    <meta name="HandheldFriendly" content="true" />
    <meta name="MobileOptimized" content="width" />
    
    <meta name="description" content="Comprehensive healthcare management platform for patient records, clinical workflows, and medical data tracking. Streamline your healthcare operations with Mobileuurka." />
    <meta name="keywords" content="healthcare management, patient records, clinical workflows, medical data, healthcare software, patient management system, electronic health records, EHR, medical records, healthcare operations, clinical documentation, patient care, medical facility management, healthcare technology, patient tracking, medical workflow automation" />
    <meta name="author" content="Mobileuurka" />
    <meta name="robots" content="index, follow" />
    <link rel="canonical" href="https://mobileuurka-gcp-server-v2-864851114868.europe-west4.run.app" />
    <title>Mobileuurka - Healthcare Management System</title>
    
    <!-- Open Graph Meta Tags for Social Media Sharing -->
    <meta property="og:title" content="Mobileuurka - Professional Healthcare Management Platform" />
    <meta property="og:description" content="Streamline your healthcare operations with Mobileuurka's comprehensive platform for patient records, clinical workflows, and medical data management. Trusted by healthcare professionals for efficient patient care." />
    <meta property="og:image" content="https://mobileuurka-gcp-server-v2-864851114868.europe-west4.run.app/logo.png" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://mobileuurka-gcp-server-v2-864851114868.europe-west4.run.app" />
    <meta property="og:site_name" content="Mobileuurka" />
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Mobileuurka - Healthcare Management System" />
    <meta name="twitter:description" content="Comprehensive healthcare management platform for patient records, clinical workflows, and medical data tracking. Streamline your healthcare operations." />
    <meta name="twitter:image" content="https://mobileuurka-gcp-server-v2-864851114868.europe-west4.run.app/logo.png" />
    
    <!-- Structured Data Markup for Search Engines -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "Mobileuurka",
      "applicationCategory": "HealthApplication",
      "applicationSubCategory": "Electronic Health Records",
      "description": "Comprehensive healthcare management platform for patient records, clinical workflows, and medical data tracking. Streamline your healthcare operations with Mobileuurka.",
      "url": "https://mobileuurka-gcp-server-v2-864851114868.europe-west4.run.app",
      "operatingSystem": "Web Browser",
      "offers": {
        "@type": "Offer",
        "category": "Healthcare Software",
        "description": "Professional healthcare management system for medical facilities"
      },
      "creator": {
        "@type": "Organization",
        "name": "Mobileuurka"
      },
      "featureList": [
        "Patient Records Management",
        "Clinical Workflows",
        "Medical Data Tracking",
        "Healthcare Operations Management",
        "Electronic Health Records"
      ]
    }
    </script>
  </head>
  <body>
    <div id="root">
      <!-- Simple loading screen -->
      <div id="initial-loading" style="
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        font-family: Arial, sans-serif;
        background: white;
        flex-direction: column;
      ">
        <div style="
          width: 40px;
          height: 40px;
          border: 4px solid #f3f3f3;
          border-top: 4px solid #007bff;
          border-radius: 50%;
          animation: spin 1s linear infinite;
          margin-bottom: 20px;
        "></div>
        <h2 style="color: #333; font-family: Arial, sans-serif;">Mobileuurka</h2>
        <p style="color: #666; font-family: Arial, sans-serif;">Loading...</p>
      </div>
    </div>

    
    <style>
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      
      /* Hide loading screen once React takes over */
      #root:not(:empty) #initial-loading {
        display: none;
      }
    </style>
    
    <!-- Cache busting for critical updates -->
    <script>
      // Add cache busting parameter for critical compatibility updates
      const cacheVersion = "v2024.12.30.1"; // Update this when fixing compatibility issues
      console.log("Cache version:", cacheVersion);
      
      // Force reload if old cache detected (for development/testing)
      const lastVersion = localStorage.getItem('app-cache-version');
      if (lastVersion && lastVersion !== cacheVersion) {
        console.log("Cache version mismatch, clearing cache");
        localStorage.setItem('app-cache-version', cacheVersion);
        // Clear various caches
        if ('caches' in window) {
          caches.keys().then(names => {
            names.forEach(name => caches.delete(name));
          });
        }
      } else {
        localStorage.setItem('app-cache-version', cacheVersion);
      }
    </script>
    
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
